# Prompt for LLM Analysis of kotlin-nkp Generated Files

You are analyzing a Kotlin codebase using architectural analysis data generated by kotlin-nkp (aNalysis of Kotlin Programs). The following files contain structured information about the codebase architecture, dependencies, and metrics.

## Available Files

### Core Data Files

1. **`model.json`** - Complete parsed code structure
   - Contains: All Kotlin files with their package names, imports, and declarations (classes, functions, properties)
   - Structure: `{"directory": "...", "files": [...]}`
   - Each file entry includes:
     - `filePath`: Full path to the source file
     - `packageName`: Package declaration
     - `imports`: Array of imported packages/classes
     - `declarations`: Array of classes, functions, properties, etc. with their types and modifiers

2. **`package-coupling.json`** - Package-level coupling metrics
   - Array of package objects, each containing:
     - `packageName`: Fully qualified package name
     - `imports`: Array of packages this package depends on
     - `coupling`: Metrics object with:
       - `afferentCoupling` (Ca): Number of packages that depend on this package (incoming)
       - `efferentCoupling` (Ce): Number of packages this package depends on (outgoing)
       - `instability` (I): Ce / (Ca + Ce), range 0.0 to 1.0

3. **`class-statistics.json`** - Per-class statistics
   - Array of class objects with:
     - `className`: Name of the class
     - `packageName`: Package containing the class
     - `classModifier`: DATA, ENUM, SEALED, INTERFACE, etc.
     - `elementType`: CLASS, INTERFACE, OBJECT, etc.
     - `metrics`: Object with counts of parameters, superTypes, declarations, classes, functions, properties, etc.

4. **`file-statistics.json`** - Per-file metrics
   - Array of file objects with:
     - `filePath`: Path to the source file
     - `imports`: Array of imported packages
     - `declarations`: Array of declared elements in the file
     - `metrics`: Counts of imports, declarations, classes, functions, properties, aliases
     - `coupling`: File-level coupling metrics (Ca, Ce, I)

5. **`packages.json`** - Package structure
   - Array of package objects, each containing:
     - `packageName`: Package name
     - `files`: Array of files in this package with their imports and declarations

6. **`search.json`** - Search results
   - Contains search results when searching for specific classes
   - Format: `{"classes": [...], "superClasses": [...], "subClasses": [...]}`

### Visualization Files

7. **`mermaid-coupling-diagram.mermaid`** - Package dependency diagram
   - Flowchart showing package dependencies
   - Color coding:
     - Green (`stable`): Instability < 0.3 (stable packages)
     - Yellow (`balanced`): Instability between 0.3 and 0.7
     - Red (`unstable`): Instability > 0.7 (unstable packages)
   - Each node shows: Package name, Instability (I), Ca, Ce values
   - Arrows show dependency direction

8. **`mermaid-import-diagram.mermaid`** - Hierarchical import structure
   - Shows package hierarchy with nested subgraphs
   - Arrows indicate import dependencies between packages

9. **`mermaid-class-diagram.mermaid`** - Class hierarchy diagram
   - UML-style class diagram showing:
     - Class properties and methods
     - Inheritance relationships (`<|--` means "extends" or "implements")
     - Method modifiers like `override`, visibility modifiers

## Key Metrics Interpretation

### Instability (I) Metric
- **I = 0.0**: Maximally stable - many packages depend on it, but it depends on nothing (e.g., domain models)
- **I = 0.0-0.3**: Stable - should contain abstract classes, interfaces, or stable domain logic
- **I = 0.3-0.7**: Balanced - reasonable coupling in both directions
- **I = 0.7-1.0**: Unstable - depends on many packages, few depend on it (e.g., adapters, infrastructure)
- **I = 1.0**: Maximally unstable - depends on everything, nothing depends on it

### Coupling Metrics
- **High Afferent Coupling (Ca)**: Many packages depend on this package - it's a core/central component
- **High Efferent Coupling (Ce)**: This package depends on many others - it's likely an adapter or orchestration layer
- **Ideal Architecture**: 
  - Domain/core packages should have **low I** (stable)
  - Adapter/infrastructure packages should have **high I** (unstable)
  - Packages with both high Ca and high Ce may indicate design issues

### Robert C. Martin's Dependency Rule
- **Stable packages** (I < 0.5) should not depend on **unstable packages** (I > 0.5)
- Violations indicate potential architectural issues

## Analysis Guidelines

When analyzing this codebase, consider:

1. **Architectural Layers**
   - Identify domain/core packages (typically stable, low I)
   - Identify adapter/infrastructure packages (typically unstable, high I)
   - Check if dependency direction follows clean architecture principles (outer layers depend on inner layers)

2. **Package Organization**
   - Are packages logically grouped?
   - Are there packages with too many responsibilities?
   - Are there circular dependencies (check `mermaid-import-diagram.mermaid`)?

3. **Coupling Issues**
   - Packages with high instability that should be stable (design problem)
   - Packages with both high Ca and high Ce (potential design issue)
   - Packages that violate dependency direction rules

4. **Class Structure**
   - Inheritance depth and complexity
   - Class sizes and responsibilities
   - Interface vs implementation ratios

5. **Import Analysis**
   - Which packages are most imported (core dependencies)?
   - Are there unnecessary cross-layer dependencies?
   - Are external library dependencies properly isolated?

## Output Format

When providing analysis, structure your response as:

1. **Architectural Overview**
   - Overall architecture pattern (if identifiable)
   - Layer identification and responsibilities
   - Dependency flow assessment

2. **Metrics Summary**
   - Most stable packages (low I)
   - Most unstable packages (high I)
   - Packages with concerning metrics

3. **Issues and Anomalies**
   - Architectural violations
   - Unexpected coupling patterns
   - Design concerns

4. **Recommendations**
   - Refactoring suggestions
   - Architectural improvements
   - Dependency management improvements

## Example Queries You Should Be Able to Answer

- "What is the overall architecture of this codebase?"
- "Which packages are the most stable and why?"
- "Are there any architectural violations in the dependency structure?"
- "What packages have the highest coupling and should they be refactored?"
- "How well does this codebase follow clean architecture principles?"
- "Which classes have the most dependencies?"
- "Are there any circular dependencies between packages?"

## Notes

- All file paths in the JSON files are relative to the analyzed directory
- The `model.json` may contain parsing artifacts like "ERROR PARAM NAME" or "ERROR PARAM TYPE" - these indicate the parser couldn't fully resolve certain constructs
- Empty arrays in `search.json` mean no results were found for that search
- Mermaid diagrams can be rendered at https://mermaid.live/ or using mermaid-cli

## Context

You are analyzing a Kotlin codebase. The tool parsed Kotlin source files and extracted structural information, imports, and relationships. This is static analysis - no runtime behavior is captured, only code structure and dependencies.

